<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<body>
    <form onsubmit="addData(event)">
        <input type="text" placeholder="Enter Your Name" id="name">
        <input type="text" placeholder="Enter your subject" id="subject">
        <input type="submit" id="subBtn">
    </form>
    <table border="1" width="60%">
        <thead>
            <tr>
                <th>Id</th>
                <th>Name</th>
                <th>Subject</th>
                <th colspan="2">Action</th>
            </tr>
        </thead>
        <tbody id="tbody"></tbody>
    </table>
</body>

</html>
<script>
    let name = document.getElementById("name")
    let subject = document.getElementById("subject")
    let editId = null;

    function addData(event) {
        event.preventDefault()

        let existingData = JSON.parse(localStorage.getItem("student")) || []

        if(editId){
            existingData.map((data)=>{
                if(data.id == editId){
                    data.name = name.value;
                    data.subject = subject.value;
                }else{
                    data
                }
            })
            editId = null
            document.getElementById("subBtn").value = "Submit"
        }else{
            let obj = {
                id: Date.now(),
                name: name.value,
                subject: subject.value
            }
            existingData.push(obj)
        }


        localStorage.setItem("student", JSON.stringify(existingData))
        name.value = ""
        subject.value = ""
        document.getElementById("subBtn").value = "SAAS"

        getData();
    }

    function getData() {
        let tbody = document.getElementById("tbody");
        tbody.innerHTML = "";

        let allData = JSON.parse(localStorage.getItem("student")) || [];

        for (let i = 0; i < allData.length; i++) {
            let row = tbody.insertRow();    //insert Row
            let cell0 = row.insertCell(0);  //insert first column id
            let cell1 = row.insertCell(1);  //insert second column name
            let cell2 = row.insertCell(2);  //insert third column subject
            let cell3 = row.insertCell(3);  //delete btn
            let cell4 = row.insertCell(4);  //edit btn

            cell0.innerText = allData[i].id
            cell1.innerText = allData[i].name
            cell2.innerText = allData[i].subject

            cell3.innerHTML = `<button class="deleteBtn" data-id="${allData[i].id}">Delete</button>`
            cell4.innerHTML = `<button class="editBtn" data-id="${allData[i].id}">Edit</button>`


            let DeleteBtns = document.querySelectorAll(".deleteBtn");

            DeleteBtns.forEach((btn) => {
                btn.addEventListener("click", () => {
                    let allData = JSON.parse(localStorage.getItem("student")) || [];
                    let btnId = btn.getAttribute("data-id");

                    let remainingData = allData.filter((data) => data.id != parseInt(btnId,10))

                    localStorage.setItem("student", JSON.stringify(remainingData))

                    getData();
                })
            })



            let editBtns = document.querySelectorAll(".editBtn")

            editBtns.forEach((btn)=>{
                let allData = JSON.parse(localStorage.getItem("student")) || [];
                let btnId = btn.getAttribute("data-id");

                let singleData = allData.find((data)=>data.id==btnId)

                name.value = singleData.name
                subject.value = singleData.subject

                editId = btnId

                document.getElementById("subBtn").value = "Update"
            })
        }
    }
    getData();


    
</script>
